name: ğŸš€ Deploy Retrocession Module

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Pull from GitHub to Server
        uses: appleboy/ssh-action@master
        with:
          host: "sat.vapeshop.ch"
          username: "root"
          key: ${{ secrets.SSH_PRIV_KEY }}
          script: |
            echo "ğŸ“ Cloning latest repo..."
            cd /home/docker/odoo/git/odoo-retrocessions
            git pull origin main || { echo "âŒ Git pull failed"; exit 1; }

            echo "ğŸ§¹ Cleaning old module..."
            rm -rf /home/docker/odoo/addons/retrocession_module

            echo "ğŸ“¦ Copying new module..."
            cp -r retrocession_module /home/docker/odoo/addons/

            echo "ğŸ“¡ Updating Odoo module..."
            docker exec -i odoo odoo -u retrocession_module -d odoo --stop-after-init

            echo "â™»ï¸ Restarting Odoo container..."
            docker restart odoo

            echo "âœ… Deployment completed successfully."
